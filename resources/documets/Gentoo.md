ВВЕДЕНИЕ

Что такое Gentoo Linux и в чём его плюсы-минусы?
Гента - это метадистрибутив Linux на базе открытых исходников. Сие означает:
1. После установки вы получите только консоль с выходом интернет, всё остальное пользователь допиливает сам.
2. При установке приложений скачивается не готовый бинарник, а исходный код, из которого собирается само приложение. 
После закачки кода приложение собирается автоматически на основе установленных пользователем локальных и/или глобальных параметров.

Плюсы:
1. Из исходного кода можно собрать идеальную конфетку для себя любимого, отбросив ненужности.
2. Код оптимизируется под ваше железо. 
3. Единый репозиторий для всего вообще. Например, чтобы скачать firefox или chromium вам не нужно ковырять файлы данных и вписывать дополнительные репозитории, достаточно просто написать "emerge firefox" или "emerge chromium" 
4. Наверное, самый тонконастраиваемый дистрибутив из всех.
5. Система очень стабильна и надёжна: достаточно один раз настроить и всё будет работать как атомные часы. Хоть целую вечность.

Минусы:
1. Компиляция бинарников - иногда дело долгое, а иногда даже очень долгое.
2. Чтобы собрать идеальную конфетку нужен опыт и знания. И копипаста тут бессильна.


Гайд предназначен для малоопытных пользователей Linux, которые хотят установить Генту посредством копи-пасты. 
Тут следует уточнить, что данный дистрибутив не сильно дружелюбен к копипасте вообще, поэтому мы очень сильно сократим и упростим некоторые "сложности", чтобы у нас всё получилось. Кое-где всё же придётся применить и свой интеллект, поэтому никаких гарантий идеальной установки я не даю.

Задача: установить Gentoo С НУЛЯ с графической средой, минимальным набором программ для удобства и перевести всё на русский язык. 
Проще говоря, вы получите систему с рабочим столом, браузером, файловым менеджером. Это будет основа, всё остальное вы сможете настроить и перенастроить ещё не раз. Когда угодно.

ВНИМАНИЕ: Инструкция расчитана на установку Gentoo amd64 на загрузочную USB-флешку с подключённым проводным интернетом.

Примерное время на установку всего: ~4-5 часов (здесь и далее ориентировка примерного времени сборки на процессор i7, менее производительные затребуют больше времени)
Непосредственное участие пользователя: около 20-30 минут.

НАЧАЛО

0. Готовим чистую, отформатированную в FAT32 флешку минимум на 4 Gb ёмкостью.
1. Качаем Hybrid ISO (LiveDVD) образ отсюда: https://www.gentoo.org/downloads/
2. Качаем Universal USB Installer отсюда http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/
3. Открываем Universal USB Installer, в Step1 выбираем Gentoo, далее указываем путь к скачанному ISO, указываем на какую флешку записывать и жмём Create.


УСТАНОВКА

Здесь и далее при установке пакетов используется алгоритм "emerge пакет", например "emerge firefox". Как только вы введете команду и нажмете ENTER сразу же пойдет загрузка.
Если вы хотите, чтобы программа спрашивала у вас подтверждение используйте ключ -av пример: "emerge -av пакет".

1. Загружаемся с установочного диска, на рабочем столе тыкаем ярлык Konsole и первым делом проверяем есть ли интернет:
ping -c3 ya.ru

Пакеты пошли? Всё хорошо, идём дальше.

ВНИМАНИЕ! Если вы выбрали Hybrid ISO (LiveDVD) образ, как я и советовал сделать, в консоле вбиваем команды
passwd ваш_пароль
попросит повторить - повторяем, запоминаем
su
вводим тот самый пароль и дальше работаем уже как SuperUser

2. Открываем программу cfdisk и смотрим, что имеем
cfdisk

3. Ограничимся тремя разделами: boot, swap, / 
Выбираем Free Space (свободное место) и жмём [ Write ]
Создаём раздел с 128М
Создаём раздел с 2G
Создаём раздел со всем оставшимся местом
На раздел с 128 мегабайтами ставим * [ Bootable ]

Предположим, что у нас это разделы
/dev/sda1
/dev/sda2
/dev/sda3
НО У ВАС ЭТО МОГУТ БЫТЬ СОВСЕМ ДРУГИЕ ЦИФРЫ (не sda1,sda2,sda3, а sda5,sda6,sda7, например), ЗАПОМНИТЕ ИХ

Нажимаем [ Write ] и выходим [ Quit ]

4. Создаём файловые системы, подключаем свап
mkfs.vfat /dev/sda1
mkfs.ext4 /dev/sda3
mkswap /dev/sda2
swapon /dev/sda2
cd /mnt/gentoo

5. Монтируем разделы на диск
mount /dev/sda3 /mnt/gentoo
mkdir /mnt/gentoo/boot
(если EFI) mkdir /mnt/gentoo/boot/efi
mount /dev/sda1 /mnt/gentoo/boot
(если EFI) mount /mnt/gentoo/boot/efi

6. Скачиваем stage 3 и дерево портажей
links http://mirror.yandex.ru/gentoo-distfiles   там идём к    /releases/amd64/autobuilds/current-stage3-amd64/stage3-amd64-20150924.tar.bz2
links http://mirror.yandex.ru/gentoo-distfiles   там идём к    /snapshots/portage-latest.tar.bz2
После скачивания выходим кнопкой Q
------------------------------------------------------------

7. Распаковываем. Это может занять порядка 5-10 минут.
tar xvjpf stage3-*.tar.bz2 && tar xvjf /mnt/gentoo/portage-latest.tar.bz2 -C /mnt/gentoo/usr

7.1 (необязательный, но желательный пункт) Указываем немного параметров для оптимизации. Это ускорит процесс компиляции.
nano /mnt/gentoo/etc/portage/make.conf
В самом верху добавляем строку:
MAKEOPTS="-jx" 
Вместо х укажите кол-во ядер вашего процессора +1, например, если у вас 8 ядер (или 4 с гипертредингом) то пишите MAKEOPTS="-j9" 
Выходим ctrl+x жмём y для сохранения

8. Настраиваем портаж
----------------СТАРЫЙ СПОСОБ (проверенно)----------------
mirrorselect -i -o >> /mnt/gentoo/etc/portage/make.conf
Выбираем Yandex
----------------------------------------------------------

--------------НОВЫЙ СПОСОБ (не проверялся)----------------
mkdir /mnt/gentoo/etc/portage/repos.conf
cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf
----------------------------------------------------------
cp -L /etc/resolv.conf /mnt/gentoo/etc/

9. Монтируем разделы proc, sys, dev
mount -t proc none /mnt/gentoo/proc
mount -o bind /dev /mnt/gentoo/dev
mount -t sysfs none /mnt/gentoo/sys

10. Переходим в нашу систему через chroot и обновляем дерево портажей
chroot /mnt/gentoo /bin/bash
env-update && source /etc/profile
export PS1="(chroot) $PS1"
emerge --sync

11. Читаем новости и выбираем профиль
eselect news read
eselect profile set 3

12. Настроим кодировку, раскладку и время
nano /etc/locale.gen
Стираем всё и добавляем:
en_US.UTF-8 UTF-8
ru_RU.UTF-8 UTF-8
Выходим ctrl+x жмём y для сохранения

cp /usr/share/zoneinfo/Europe/Moscow /etc/localtime
nano /etc/conf.d/keymaps
KEYMAP="us" меняем на KEYMAP="ru"
Выходим ctrl+x жмём y для сохранения

nano /etc/conf.d/clock
Откроется пустое окно, пишем туда:
CLOCK="local"
TIMEZONE="Europe/Moscow"
Выходим ctrl+x жмём y для сохранения

13. Качаем программы для сборки ядра и собираем ядро (займет ~10-15 минут)
emerge gentoo-sources genkernel
genkernel all

14. Качаем модули и добавляем их в автозагрузку (займёт ~15-20 минут)
emerge dhcpcd vixie-cron udev syslog-ng
rc-update add dhcpcd default
rc-update add syslog-ng default
rc-update add vixie-cron default
rc-update add udev boot

15. Правим fstab
nano /etc/fstab
Меняем 
/dev/BOOT на /dev/sda1 
/dev/ROOT на /dev/sda3
/dev/SWAP на /dev/sda2
(Если EFI) меняем в BOOT строке /boot на /boot/efi и файловую систему (след параметр) меняем на vfat
ПОМНИТЕ, У ВАС ЭТО МОГУТ БЫТЬ ДРУГИЕ ЦИФРЫ! 
/dev/cdrom - ставим # перед этой строкой (#/dev/cdrom) или просто стираем строку


16. Настраиваем сеть
ifconfig
Смотрим имя своего адаптера (смотрим в самом начале будет eth0 либо enp3s0 либо что-то в этом духе). Допустим, что наш адаптер это eth0
nano /etc/conf.d/net
Откроется пустое окно, пишем туда 
config_eth0="dhcp"

Если у вас не eth0 то вместо него впишите имя своего адаптера
Выходим ctrl+x жмём y для сохранения

17. Создаём сетевую службу и ставим её в автозапуск
cd /etc/init.d
ln -s net.lo net.eth0
rc-update add net.eth0 default
Если у вас не eth0 то вместо него впишите имя своего адаптера

18. Ставим загрузчик grub2 и os-prober (займёт ~10-20 минут)
emerge grub os-prober

--------------------ЕСЛИ BIOS------------------
grub2-install /dev/sda
grub2-mkconfig -o /boot/grub/grub.cfg
-----------------------------------------------

--------------------ЕСЛИ UEFI------------------
echo GRUB_PLATFORMS="efi-64" >> /etc/portage/make.conf (если у вас 32 битка то заменяем efi-64 на efi-32)
grub2-install --target=x86_64-efi --efi-directory=/boot
grub2-mkconfig -o /boot/grub/grub.cfg
-----------------------------------------------
Смотрим, если он определил системы, значит всё хорошо.

18. Ставим пароль для суперпользователя
passwd ваш_пароль

19. Перезагружаемся
exit
cd
reboot

20. Проверяем, всё ли хорошо?
Login: root
Password: ваш_пароль
ping -c3 ya.ru
Если пинг пошёл - мы молодцы, всё сделали правильно и самая сложная часть уже позади, можно передохнуть.

НАСТРОЙКА

1. Настройка видеокарты.
Посмотреть какая у вас видеокарта можно командой
lspci | grep -i VGA
---------------------------------------------------------------------------
а) Если у вас Radeon то сперва нужно сходить https://wiki.gentoo.org/wiki/Radeon и посмотреть там табличку Feature support. В зависимости от вашей карты вписывавем параметры
nano /etc/portage/make.conf

Допустим, у нас видеокарта R9. Тогда самом низу добавляем 
VIDEO_CARDS="radeon radeonsi"
Если другая, то добавляйте данные в VIDEO_CARDS="" на основании таблицы с сайта (столбик VIDEO_CARDS). Если это слишком сложно, попробуйте добавить просто VIDEO_CARDS="radeon"

Обновляем систему
emerge --ask --changed-use --deep @world

Качаем драйвер
emerge radeon-ucode
Если будет ругаться, попробуйте 
emerge linux-firmware
---------------------------------------------------------------------------

b) Если у вас Nvidia, то вам повезло - делать почти ничего не надо.
nano /etc/portage/make.conf
В самом низу добавляем 
VIDEO_CARDS="nouveau"
Выходим ctrl+x жмём y для сохранения
Обновляем систему
emerge --ask --changed-use --deep @world
---------------------------------------------------------------------------

c) Если у вас Intel (встроенная видеокарта), то как и в случае с Radeon нам нужны таблицы и данные. Идём https://wiki.gentoo.org/wiki/Intel и смотрим таблицу, данные берем из столбика VIDEO_CARDS.
nano /etc/portage/make.conf
В самом низу добавляем 
VIDEO_CARDS="данные из таблицы"
Выходим ctrl+x жмём y для сохранения

Обновляем систему
emerge --ask --changed-use --deep @world
---------------------------------------------------------------------------

Перезагружаемся. Консоль должна поменять разрешение на разрешение вашего экрана.

2. Установка X-Server и Cinnamon (займёт ~3 часа)
nano /etc/portage/make.conf
Найдите строку USE и смените её на:
USE="icu pulseaudio X glamor bindist python NetworkManager consolekit infinality minizip sqlite gnome-keyring"
Выходим ctrl+x жмём y для сохранения

nano .xinitrc
Откроется пустое окно, пишем туда
exec cinnamon-session
Выходим ctrl+x жмём y для сохранения



Вбиваем эти команды, жмём Enter и идём спать/на работу/на учёбу. К вашему приходу как раз всё будет готово.
emerge xorg-server cinnamon 
Далее
emerge gtk+extra xf86-video-modesetting sudo terminator
rc-update add dbus default
rc-update add consolekit default
rc-update add NetworkManager default
rc-update del net.eth0 default (вместо eth0 имя своей сетевой карты, которое вводили ранее)
reboot
3. Скрещиваем пальцы и пишем заветное
startx

Если всё хорошо, вы войдёте в Cinnamon. Если вылетела ошибка и краш, попробуйте обновить систему: emerge -uDNav world
(!) После каждой перезагрузки, чтобы попасть в систему вам нужно будет вбивать логин, пароль и вводить команду "startx". Это дело можно автоматизировать с помощью разных логин менеджеров, но об этом позже.

4. Первым делом зайдите в настройки и создайте нового пользователя, добавте его во все возможные группы и придумайте пароль от 6 символов, одни только цифры нельзя, обязательно добавте символ или букву.
В меню найдите терминал Terminator и вбейте команду
visudo

Ищём там строки и убираем значок # перед ними. Это называется "раскомментировать" опцию.
 %wheel ALL=(ALL) ALL
 %wheel ALL=(ALL) NOPASSWD: ALL (Я бы не советовал трогать эту строку т.к. она полностью отключит необходимость вводить пароль после sudo. Это как бы небезопасно, лучше оставьте # перед ней)

Выходим ctrl+x жмём y для сохранения


5. Заходим с нового пользователя
Либо ищем в меню Logout/End-Session (или как-то так)
Либо жмём ALT+CTRL+F1, выходим в консоль и нажимаем CTRL+C, если процесс не завершился
Выходим из root:
exit

Логинимся под новым пользователем, как только вы это сделали, добавьте сессию Cinnamon:
nano .xinitrc
Откроется пустое окно, пишем туда
exec cinnamon-session
Выходим ctrl+x жмём y для сохранения
startx

6. По желанию можно установить браузер. Для этого жмём меню, ищем там программу Terminator, это наша виртуальная консоль.
Бинарник файрфокса (быстрая установка):   sudo emerge firefox-bin
Сорц файрфокс (медленная установка):      sudo emerge firefox
Хром:                                     sudo emerge chromium



РУССИФИКАЦИЯ

nano /etc/env.d/02locale
Откроется пустое окно, пишем туда
LC_ALL=""
LANG="ru_RU.UTF-8"
Выходим ctrl+x жмём y для сохранения

nano /etc/conf.d/consolefont
Меняем consolefont="default8x16" на consolefont="cyr-sun16"
Выходим ctrl+x жмём y для сохранения

eselect locale list
Ищем ru_RU.utf8 (обычно под номером 4)
eselect locale set 4

Перезагружаемся

UPD: Рекомендую установить пакет шрифтов Noto, они очень хорошо смотрятся как системные шрифты и включают в себя поддержку многих языков т.е. в браузере большая часть языком будет отображаться не крокозябрами
sudo emerge noto



АВТОЛОГИН

1. Если хотите запускать десктоп без вводов логинов и паролей то качаем SLIM:
sudo emerge slim

2. Настраиваем XDM.
sudo nano /etc/conf.d/xdm
Меняем строку DISPLAYMANAGER="xdm" на DISPLAYMANAGER="slim"
Выходим ctrl+x жмём y для сохранения

3. Делаем ему автозагрузку
rc-update add xdm default

4. Настраиваем автологин
sudo nano /etc/slim.conf
Ищем строки и меням их значение, а так же убираем перед ними #:
default_user        ваш логин
auto_login          yes

Ищем строки и меняем # делай вот такой вид:
# login_cmd           exec /bin/sh - ~/.xinitrc %session
login_cmd           exec /bin/bash -login ~/.xinitrc %session
# login_cmd           exec /bin/bash -login /usr/share/slim/Xsession %session

Выходим ctrl+x жмём y для сохранения






КРАТКИЙ ВВОД В КОНСОЛЬКУ
Если вы работаете под обычным пользователем, перед этими командами ставим sudo (sudo emerge итд)

emerge пакет                                 установка
emerge --autounmask-write =пакет-версия      разрешить устанавливать версии пакетов не по-умолчанию (пример emerge --autounmask-write =firefox-40.0.3). Имеющиеся версии пакетов можно легко нагуглить "gentoo имя программы, в первых ссылках будет оф репозиторий там смотрим какие есть версии". Либо сразу искать тут https://packagestest.gentoo.org/

dispatch-conf                                просмотреть (l) измененные конфиги и подтвердить (u) либо опровергнуть (z) изменения. Вводите эту команду после использования команды выше, чтобы подтвердить изменения и после этого уже скачивайте нужную вам версию.

emerge -C пакет                              удаление 
emerge --sync                                синхронизация 
emerge -uDN world                            обновление всего
emerge -uDN system                           обновление только системных пакетов
emerge --depclean                            удаление лишних зависимостей после чистки системы или удаления какой-либо программы
emerge -e world                              полная пересборка ВСЕЙ СИСТЕМЫ (это не просто долго, это ОЧЕНЬ долго)
